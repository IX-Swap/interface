name: Integration Tests

on:
  push:
    branches:
      - metamask-tests
      - main
      - development
  pull_request:
    branches:
      - main
      - development

jobs:
  integration-tests:
    fail-fast: false
    matrix:
      browser: [chromium, firefox, webkit]
  runs-on: ubuntu-20.04
  steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: 14
    - run: npm ci
      env:
        DEBUG: pw:install
    - run: npm run build
    - run: node lib/cli/cli install-deps ${{ matrix.browser }} chromium
    - run: xvfb-run --auto-servernum --server-args="-screen 0 1280x960x24" -- npm run integration-test -- --project=${{ matrix.browser }}
